<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Web Serial API - Reading Test</title>
    </head>
    <body>
        <h3>ã¯ã˜ã‚ã¦ã®Web Serial APIï½œèª­è¾¼ãƒ†ã‚¹ãƒˆ</h3>
        <button onclick="startSerial()">æ¥ç¶š</button>
        <button onclick="stopSerial()">åˆ‡æ–­</button>
        <script>
            let stopFlag = false;
            async function startSerial() {
                try {
                    console.log("INFO: æ¥ç¶šãŒç¢ºç«‹ã—ã¾ã—ãŸ");
                    stopFlag = false;
                    const port = await navigator.serial.requestPort();
                    await port.open({ baudRate: 9600 });
                    while (port.readable) {
                        const reader = port.readable.getReader();
                        try {
                            while (!stopFlag) {
                                const { value, done } = await reader.read();
                                if (done) {
                                    console.log("INFO: èª­è¾¼ãƒ¢ãƒ¼ãƒ‰çµ‚äº†");
                                    break;
                                }
                                //ğŸ‘‡ç”Ÿãƒ‡ãƒ¼ã‚¿ã¯ãƒã‚¤ãƒŠãƒªãªã®ã§ã€ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—ã¸ãƒ‡ã‚³ãƒ¼ãƒ‰
                                const inputValue = new TextDecoder().decode(value);
                                console.log(inputValue);
                            }
                        } catch (error) {
                            console.log("ERROR: èª­ã¿å‡ºã—å¤±æ•—");
                            console.log(error);
                        } finally {
                            reader.releaseLock();
                            await port.close();
                            console.log("INFO: æ¥ç¶šã‚’åˆ‡æ–­ã—ã¾ã—ãŸ");
                        }
                    }
                } catch (error) {
                    console.log("ERRORR: ãƒãƒ¼ãƒˆãŒé–‹ã‘ã¾ã›ã‚“");
                    console.log(error);
                }
            }
            function stopSerial() {
                stopFlag = true;
            }
        </script>
    </body>
</html>